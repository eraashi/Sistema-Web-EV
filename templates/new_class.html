{% extends 'base.html' %}

{% block title %}Nova Turma{% endblock %}

{% block header %}Nova Turma{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-md">
    <form id="new-class-form">
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Nome</label>
            <input type="text" id="nome" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Tipo</label>
            <select id="tipo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                <option value="cognitiva">Cognitiva</option>
                <option value="motora">Motora</option>
            </select>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Faixa Etária (ex: 4,5)</label>
            <input type="text" id="faixa_etaria" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Dia da Semana</label>
            <select id="dia_semana" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                <option value="seg">Segunda-feira</option>
                <option value="ter">Terça-feira</option>
                <option value="qua">Quarta-feira</option>
                <option value="qui">Quinta-feira</option>
                <option value="sex">Sexta-feira</option>
            </select>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Período</label>
            <select id="periodo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                <option value="manha">Manhã</option>
                <option value="tarde">Tarde</option>
            </select>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Capacidade</label>
            <input type="number" id="capacidade" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
        </div>
        <div class="flex justify-end">
            <button type="button" onclick="window.history.back()" class="bg-gray-500 text-white px-4 py-2 rounded-md mr-2 hover:bg-gray-600">Cancelar</button>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Salvar</button>
        </div>
    </form>
</div>
<script>
    document.getElementById('new-class-form').onsubmit = async (e) => {
        e.preventDefault();
        const turma = {
            nome: document.getElementById('nome').value,
            disciplina: document.getElementById('tipo').value === 'cognitiva' ? 'Matemática' : 'Futebol',
            tipo: document.getElementById('tipo').value,
            faixa_etaria: document.getElementById('faixa_etaria').value,
            dia_semana: document.getElementById('dia_semana').value,
            periodo: document.getElementById('periodo').value,
            capacidade: parseInt(document.getElementById('capacidade').value),
            polo_id: '{{ user.polo_id }}'
        };
        try {
            const response = await fetch('/api/turmas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(turma)
            });
            if (!response.ok) throw new Error('Erro ao criar turma');
            window.location.href = '/classes';
        } catch (error) {
            alert('Erro: ' + error.message);
        }
    };
</script>
{% endblock %}